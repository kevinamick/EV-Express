<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="fullPage.js/jquery.fullPage.css" />
	<link rel="stylesheet" type="text/css" href="css/index.css" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/lightbox.css" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="fullPage.js/vendors/jquery.easings.min.js"></script>
	<script type="text/javascript" src="fullPage.js/jquery.fullPage.js"></script>
	<link rel="stylesheet" type="text/css" href="fullPage.js/backgrounds.css" />
	<script type="text/javascript">
		$(document).ready(function () {
			$('#fullpage').fullpage({
				slidesColor: ['#428BCA', '#5CB85C', '#5BC0DE', '#F0AD4E', '#FF530D', '#FFFFFF'], // Bootstrap
				anchors: ['home', 'map', 'aboutus', 'contact']
				, menu: '#menu'
				, normalScrollElements: '#gmap_canvas'
			});
		});
	</script>
	<style>
		input,
		textarea {
			opacity: 0.8;
		}
		
		#navbar-collapse-1 {
			font-size: medium;
		}
		
		.section.table {
			margin: 0;
		}
		
		.controlArrow {
			opacity: 0.5;
		}
		
		.controlArrow:hover {
			opacity: 1;
		}
		
		#map {
			position: relative;
			width: 100% !important;
			overflow: hidden;
		}
		
		#gmap_canvas {
			height: 100%;
			width: 100%;
		}
		
		@media (max-width: 768px) {
			.container {
				margin: 0 10px;
			}
			h1 {
				font-size: 26px !important;
			}
			p,
			label {
				font-size: 16px !important;
			}
		}
		
		@media (min-width: 769px) and (max-width: 980px) {
			h1 {
				font-size: 34px !important;
			}
			p,
			label {
				font-size: 20px !important;
			}
		}
		
		@media (min-width: 981px) {
			h1 {
				font-size: 48px !important;
			}
			p,
			label {
				font-size: 24px !important;
			}
		}
	</style>
</head>

<body>
	<nav id="menu" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="index.html">EV-Express</a> </div>
			<div class="collapse navbar-collapse" id="navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li data-menuanchor="home" class="active"><a href="#home">Home</a></li>
					<li data-menuanchor="map"><a href="#map">Map</a></li>
					<li data-menuanchor="aboutus"><a href="#aboutus">About us</a></li>
					<li data-menuanchor="contact"><a href="#contact">Contact</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div id="fullpage">
		<div class="section" id="section0">
			<div class="container">
				<div class="row">
					<div class="col-xs-12 bg-content">
						<h1>Find Your Nearest EV Charging Station</h1>
						<p>
							<!--Welcome News...-->
						</p>
						<p> Find electric vehicle charging stations near an address or ZIP code or along a route in the United States.
							<br> </p>
					</div>
				</div>
			</div>
		</div>
		<div class="section" id="section1 map">
			<input id="origin-input" class="controls" type="text" placeholder="Enter an origin location">
			<input id="destination-input" class="controls" type="text" placeholder="Enter a destination location">
			<div id="bat" class="col-sm-1"> <strong>Battery Level:</strong>
				<select id="bat-lvl">
					<option value="1/4">1/4</option>
					<option value="1/2">1/2</option>
					<option value="3/4">3/4</option>
					<option value="full">Full</option>
				</select>
			</div>
			<div id="connect"> <strong>Connector Type:</strong>
				<select id="c-type">
					<option value="NEMA515">NEMA 5-15 (Level 1)</option>
					<option value="NEMA520">NEMA 5-20 (Level 1)</option>
					<option value="NEMA1450">NEMA 14-50 (Level 1)</option>
					<option value="J1772">J1772 (Level 2)</option>
					<option value="CHADEMO">CHAdeMO (DC fast charging)</option>
					<option value="J1772COMBO"> SAE J1772 Combo (DC fast charging)</option>
					<option value="TESLA">Tesla (DC fast charging)</option>
				</select>
			</div>
			<div id="dir-panel"></div>
			<div id='gmap_canvas'></div>
			<style>
				#gmap_canvas img {
					max-width: none!important;
					background: none!important
				}
				
				.controls {
					margin-top: 60px;
					border: 1px solid transparent;
					border-radius: 2px 0 0 2px;
					box-sizing: border-box;
					-moz-box-sizing: border-box;
					height: 32px;
					width: 100%;
					outline: none;
					box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
				}
				
				#origin-input,
				#destination-input {
					position: relative;
					background-color: #fff;
					font-family: Roboto;
					font-size: 15px;
					font-weight: 300;
					padding: 0 11px 0 13px;
					text-overflow: ellipsis;
					width: 200px;
				}
				
				#destination-input {
					margin-left: 12px;
				}
				
				#origin-input:focus,
				#destination-input:focus {
					border-color: #4d90fe;
				}
				
				#bat {
					margin-top: 60px;
					margin-left: 12px;
					z-index: 5;
					padding: 5px;
					border: 1px solid transparent;
					border-radius: 2px 0 0 2px;
					box-sizing: border-box;
					text-align: center;
					font-family: 'Roboto', 'sans-serif';
					height: 32px;
					width: 150px;
					padding-left: 10px;
					outline: none;
					background: rgba(255, 255, 255, 0.8);
					box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
				}
				
				#bat-lvl {
					padding-top: 2px;
				}
				
				#connect {
					margin-top: 60px;
					margin-left: 12px;
					z-index: 6;
					padding: 5px;
					border: 1px solid transparent;
					border-radius: 2px 0 0 2px;
					box-sizing: border-box;
					text-align: center;
					font-family: 'Roboto', 'sans-serif';
					height: 32px;
					width: 325px;
					padding-left: 10px;
					outline: none;
					background: rgba(255, 255, 255, 0.8);
					box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
				}
				
				#c-type {
					padding-top: 2px;
				}
				
				#type-selector {
					color: #fff;
					background-color: #4d90fe;
					padding: 5px 11px 0px 11px;
				}
				
				#type-selector label {
					font-family: Roboto;
					font-size: 13px;
					font-weight: 300;
				}
				
				#target {
					width: 345px;
				}
				
				#dir-panel {
					font-family: 'Roboto', 'sans-serif';
					line-height: 30px;
					padding-left: 10px;
					margin-top: 50px;
					border: 1px solid transparent;
					border-radius: 2px 0 0 2px;
				}
				
				#dir-panel select,
				#dir-panel input {
					font-size: 15px;
				}
				
				#dir-panel select {
					width: 100%;
				}
				
				#dir-panel i {
					font-size: 12px;
				}
				
				#dir-panel {
					height: 58%;
					float: right;
					width: 400px;
					overflow-y: auto;
				}
				
				.adp {
					position: relative;
					background: rgba(255, 255, 255, 0.9);
				}
			</style>
			<script type='text/javascript'>
				var center;
				var lat1;
				var lng1;
				var map;
				//Google Maps Function
				function init_map() {
					var origin_place_id = null;
					var destination_place_id = null;
					//Map Options
					var myOptions = {
						zoom: 15
						, mapTypeId: google.maps.MapTypeId.ROADMAP
					};
					//Create Map
					map = new google.maps.Map(document.getElementById('gmap_canvas'), myOptions);
					// Try HTML5 geolocation.
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(function (position) {
							var pos = {
								lat: position.coords.latitude
								, lng: position.coords.longitude
							};
							map.setCenter(pos);
						}, function () {
							handleLocationError(true, infoWindow, map.getCenter());
						});
					}
					else {
						// Browser doesn't support Geolocation
						handleLocationError(false, infoWindow, map.getCenter());
					}
					//Startup directions service
					var directionsService = new google.maps.DirectionsService;
					var directionsDisplay = new google.maps.DirectionsRenderer;
					var service = new google.maps.DistanceMatrixService();
					directionsDisplay.setMap(map);
					directionsDisplay.setPanel(document.getElementById('dir-panel'));
					// Inputs/displays
					var origin_input = document.getElementById('origin-input');
					var destination_input = document.getElementById('destination-input');
					var bat_display = document.getElementById('bat');
					var c_display = document.getElementById('connect');
					var bat_input = document.getElementById('bat-lvl').value;
					var c_input = document.getElementById('c-type').value;
					//place items on map
					map.controls[google.maps.ControlPosition.TOP_CENTER].push(origin_input);
					map.controls[google.maps.ControlPosition.TOP_CENTER].push(destination_input);
					map.controls[google.maps.ControlPosition.TOP_CENTER].push(bat_display);
					map.controls[google.maps.ControlPosition.TOP_CENTER].push(c_display);
					map.controls[google.maps.ControlPosition.LEFT].push(document.getElementById('dir-panel'));
					//Listener for viewport change
					google.maps.event.addListener(map, "center_changed", function () {
						center = map.getCenter();
						lat1 = center.lat();
						lng1 = center.lng();
						// load markers
						loadMarkers();
					});
					//auto complete functions
					var origin_autocomplete = new google.maps.places.Autocomplete(origin_input);
					origin_autocomplete.bindTo('bounds', map);
					var destination_autocomplete = new google.maps.places.Autocomplete(destination_input);
					destination_autocomplete.bindTo('bounds', map);

					function expandViewportToFitPlace(map, place) {
						if (place.geometry.viewport) {
							map.fitBounds(place.geometry.viewport);
						}
						else {
							map.setCenter(place.geometry.location);
							map.setZoom(17);
						}
					}
					var o_place;
					var o_LtLnG;
					origin_autocomplete.addListener('place_changed', function () {
						o_place = origin_autocomplete.getPlace();
						var lat = o_place.geometry.location.lat();
						var lng = o_place.geometry.location.lng();
						o_LtLnG = new google.maps.LatLng(lat, lng);
						if (!o_place.geometry) {
							window.alert("Autocomplete's returned place contains no geometry");
							return;
						}
						expandViewportToFitPlace(map, o_place);
						// If the place has a geometry, store its place ID and route if we have
						// the other place ID
						origin_place_id = o_place.place_id;
						route(origin_place_id, destination_place_id, directionsService, directionsDisplay);
					});
					destination_autocomplete.addListener('place_changed', function () {
						var place = destination_autocomplete.getPlace();
						var lat = place.geometry.location.lat();
						var lng = place.geometry.location.lng();
						var d_LtLnG = new google.maps.LatLng(lat, lng);
						if (!place.geometry) {
							window.alert("Autocomplete's returned place contains no geometry");
							return;
						}
						expandViewportToFitPlace(map, place);
						// If the place has a geometry, store its place ID and route if we have
						// the other place ID
						destination_place_id = place.place_id;
						// Distance matrix call to calculate distance and duration
						service.getDistanceMatrix({
							origins: [o_LtLnG]
							, destinations: [d_LtLnG]
							, travelMode: 'DRIVING'
						}, callback);
						// for distance/duration calculation
						function callback(response, status) {
							var distance;
							var duration;
							var findPoint;
							if (status == 'OK') {
								var origins = response.originAddresses;
								var destinations = response.destinationAddresses;
								for (var i = 0; i < origins.length; i++) {
									var results = response.rows[i].elements;
							
									for (var j = 0; j < results.length; j++) {
										var element = results[j];
										distance = element.distance.value;
										duration = element.duration.text;
									}
								}
							}
							//If the distance is within the charge limit, give route.
							//Else, find charging station(s) in between.
							if (bat_input == 'full') {
								if (distance < 200000) {
									findPoint = false;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
								else {
									//Will find charging station(s) along the route
									findPoint = true;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
							}
							else if (bat_input == '3/4') {
								if (distance < 150000) {
									findPoint = false;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
								else {
									//Will find charging station(s) along the route
									findPoint = true;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
							}
							else if (bat_input == '1/2') {
								if (distance < 100000) {
									findPoint = false;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
								else {
									//Will find charging station(s) along the route
									findPoint = true;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
							}
							else {
								if (distance < 50000) {
									findPoint = false;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
								else {
									//Will find charging station(s) along the route
									findPoint = true;
									route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance);
								}
							}
						}
					});
					//Calculate route
					function route(origin_place_id, destination_place_id, directionsService, directionsDisplay, findPoint, bat_input, distance) {
						var midLat;
						var midLng;
						var way = [];
						if (!origin_place_id || !destination_place_id) {
							return;
						}
						if (!findPoint) {
							directionsService.route({
								origin: {
									'placeId': origin_place_id
								}
								, destination: {
									'placeId': destination_place_id
								}
								, travelMode: 'DRIVING'
							}, function (response, status) {
								if (status === 'OK') {
									directionsDisplay.setDirections(response);
								}
								else {
									window.alert('Directions request failed due to ' + status);
								}
							});
						}
						else {
							directionsService.route({
								origin: {
									'placeId': origin_place_id
								}
								, destination: {
									'placeId': destination_place_id
								}
								, travelMode: 'DRIVING'
							}, function (response, status) {
								if (status === 'OK') {
									bat_input = document.getElementById('bat-lvl').value;
									var pointsArray = [];
									var seg = [];
									pointsArray = response.routes[0].overview_path;
									directionsDisplay.setDirections(response);
						
									if (bat_input == 'full') {
										var n = distance / 200000;
										var section = (pointsArray.length - 1) / (n - 1);
										for (var i = 0; i < n; i++) {
											var num = Math.round(Math.floor(section * i));
											seg[i] = num;
										}
										findPoint(pointsArray, seg);
									}
								}
								else {
									window.alert('Directions request failed due to ' + status);
								}
							});
							var findPoint = function (pointsArray, seg) {
								for (var i = 1; i < seg.length - 1; i++) {
				
									var lat = pointsArray[seg[i]].lat();
									var lng = pointsArray[seg[i]].lng();
									
									$.ajax({
										url: 'https://developer.nrel.gov/api/alt-fuel-stations/v1/nearest.json?fuel_type=ELEC&latitude=' + lat + '&longitude=' + lng + '&radius=500&api_key=PbhPOEFCBL7tQBv3YoW0G8yyfdymUMD5Ng0u0pRJ&format=JSON&limit=1'
										, type: 'GET'
										, dataType: 'json'
										, async: false
										, success: function (data) {
											wayLat = data.fuel_stations.latitude;
											wayLng = data.fuel_stations.longitude;
											way.push({
												location: new google.maps.LatLng(wayLat, wayLng)
												, stopover: true
											});
											console.log(wayLat);
										}
									});
								}
								finalRoute(way);
							}
							var finalRoute = function (way) {
								directionsService.route({
									origin: {
										'placeId': origin_place_id
									}
									, destination: {
										'placeId': destination_place_id
									}
									, waypoints: way
									, travelMode: 'DRIVING'
								}, function (response, status) {
									if (status === 'OK') {
										directionsDisplay.setDirections(response);
									}
									else {
										window.alert('Directions request failed due to ' + status);
									}
								});
							}
						}
					}
				};

				function handleLocationError(browserHasGeolocation, infoWindow, pos) {
					infoWindow.setPosition(pos);
					infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.' : 'Error: Your browser doesn\'t support geolocation.');
				}
				// draw station markers
				function loadMarkers() {
					// load marker jSon data
					$.getJSON('https://developer.nrel.gov/api/alt-fuel-stations/v1/nearest.json?fuel_type=ELEC&latitude=' + lat1 + '&longitude=' + lng1 + '&radius=500&api_key=PbhPOEFCBL7tQBv3YoW0G8yyfdymUMD5Ng0u0pRJ&format=JSON', function (data) {
						// loop all the markers
						$.each(data.fuel_stations, function (i, item) {
							var myLatlng = new google.maps.LatLng(item.latitude, item.longitude);
							// create new marker
							var marker = new google.maps.Marker({
								id: item.id
								, map: map
								, title: item.station_name
								, position: myLatlng
							});
							var contentString = '<div id="content">' + '<div id="siteNotice">' + '</div>' + '<h1 id="firstHeading" class="firstHeading">' + item.station_name + '</h1>' + '<div id="bodyContent">' + '<p>' + item.street_address + '<br>' + item.state + ', ' + item.zip + '</p>' + '</div>';
							var infowindow = new google.maps.InfoWindow({
								content: contentString
							});
							marker.addListener('click', function () {
								infowindow.open(map, marker);
							});
						});
					});
				}
			</script>
			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYVa_2Ndl-F-y2Ct2_FNGhLIgDevaOENU&libraries=places&callback=init_map" async defer></script>
		</div>
		<div class="section" id="section2">
			<div class="container">
				<div class="row">
					<div class="col-xs-12 bg-content">
						<h1>About us</h1>
						<p>Lorem Ipsum</p>
					</div>
				</div>
			</div>
		</div>
		<div class="section" id="section3">
			<div class="container">
				<div class="row">
					<div class="col-xs-12 bg-content">
						<h1>Contact</h1>
						<form class="form-horizontal" role="form">
							<div class="form-group">
								<label for="inputName" class="col-sm-2 control-label">Name</label>
								<div class="col-sm-10">
									<input type="name" class="form-control" id="inputName" placeholder="your Name"> </div>
							</div>
							<div class="form-group">
								<label for="inputEmail" class="col-sm-2 control-label">Email</label>
								<div class="col-sm-10">
									<input type="email" class="form-control" id="inputEmail" placeholder="your Email"> </div>
							</div>
							<div class="form-group">
								<label for="inputText" class="col-sm-2 control-label">Message</label>
								<div class="col-sm-10">
									<textarea class="form-control" rows="3" placeholder="your Message"></textarea>
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<button type="submit" class="btn btn-default">Send Mail <span class="glyphicon glyphicon-send"></span></button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>